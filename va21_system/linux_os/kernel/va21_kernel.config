# VA21 Research OS - Full Stripped-Down Linux Kernel Configuration
# ===================================================================
# This is a REAL Linux kernel configuration stripped down to essentials
# for the VA21 Research OS. Based on Linux 6.x LTS with Debian compatibility.
#
# This kernel configuration is designed to:
#   - Provide a minimal but fully functional Linux kernel
#   - Support Debian GNU/Linux userland (glibc, GNU coreutils)
#   - Enable Guardian AI security features (BPF, seccomp, LSM)
#   - Support container environments (Docker, Podman)
#   - Include essential drivers for virtual and physical hardware
#
# Build with: make ARCH=x86_64 menuconfig (to customize)
#             make ARCH=x86_64 -j$(nproc)
#
# GNU/Linux Compatibility:
#   - Full POSIX compliance for GNU coreutils
#   - glibc ABI compatibility
#   - SystemD optional support
#   - Full namespace support for containers
#
# Om Vinayaka - Real GNU/Linux power, minimal footprint.

#
# General Setup
#
CONFIG_LOCALVERSION="-va21"
CONFIG_LOCALVERSION_AUTO=y
CONFIG_DEFAULT_HOSTNAME="va21"
CONFIG_SYSVIPC=y
CONFIG_POSIX_MQUEUE=y
CONFIG_AUDIT=y
CONFIG_AUDITSYSCALL=y

# Kernel compression
CONFIG_KERNEL_GZIP=y
# CONFIG_KERNEL_BZIP2 is not set
# CONFIG_KERNEL_LZMA is not set
# CONFIG_KERNEL_XZ is not set
# CONFIG_KERNEL_LZO is not set
# CONFIG_KERNEL_LZ4 is not set
# CONFIG_KERNEL_ZSTD is not set

# Timers
CONFIG_NO_HZ_IDLE=y
CONFIG_HIGH_RES_TIMERS=y

# Preemption
CONFIG_PREEMPT_VOLUNTARY=y

# RCU
CONFIG_TREE_RCU=y

# Scheduler
CONFIG_CGROUPS=y
CONFIG_CGROUP_SCHED=y
CONFIG_FAIR_GROUP_SCHED=y

# Namespaces (for containers)
CONFIG_NAMESPACES=y
CONFIG_UTS_NS=y
CONFIG_IPC_NS=y
CONFIG_USER_NS=y
CONFIG_PID_NS=y
CONFIG_NET_NS=y

# Memory
CONFIG_MEMCG=y
CONFIG_MEMCG_SWAP=y

# BPF (for Guardian AI monitoring)
CONFIG_BPF=y
CONFIG_BPF_SYSCALL=y
CONFIG_BPF_JIT=y
CONFIG_BPF_JIT_ALWAYS_ON=y
CONFIG_BPF_LSM=y
CONFIG_CGROUP_BPF=y

#
# Processor Type and Features
#
CONFIG_SMP=y
CONFIG_NR_CPUS=256
CONFIG_X86_64=y
CONFIG_X86_LOCAL_APIC=y
CONFIG_X86_IO_APIC=y
CONFIG_MCORE2=y

# CPU frequency scaling
CONFIG_CPU_FREQ=y
CONFIG_CPU_FREQ_GOV_PERFORMANCE=y
CONFIG_CPU_FREQ_GOV_POWERSAVE=y
CONFIG_CPU_FREQ_GOV_ONDEMAND=y
CONFIG_CPU_FREQ_DEFAULT_GOV_ONDEMAND=y

#
# Power Management
#
CONFIG_PM=y
CONFIG_PM_SLEEP=y
CONFIG_ACPI=y
CONFIG_ACPI_BUTTON=y
CONFIG_ACPI_FAN=y
CONFIG_ACPI_PROCESSOR=y
CONFIG_ACPI_THERMAL=y

#
# Executable File Formats
#
CONFIG_BINFMT_ELF=y
CONFIG_BINFMT_SCRIPT=y
CONFIG_BINFMT_MISC=y

#
# Memory Management
#
CONFIG_MMU=y
CONFIG_TRANSPARENT_HUGEPAGE=y
CONFIG_MEMORY_HOTPLUG=y
CONFIG_KSM=y

#
# Networking
#
CONFIG_NET=y
CONFIG_PACKET=y
CONFIG_UNIX=y
CONFIG_INET=y
CONFIG_IP_MULTICAST=y
CONFIG_IP_ADVANCED_ROUTER=y
CONFIG_IP_PNP=y
CONFIG_IP_PNP_DHCP=y
CONFIG_TCP_CONG_CUBIC=y
CONFIG_DEFAULT_TCP_CONG="cubic"

# IPv6
CONFIG_IPV6=y

# Netfilter/iptables (for Guardian firewall)
CONFIG_NETFILTER=y
CONFIG_NETFILTER_ADVANCED=y
CONFIG_NF_CONNTRACK=y
CONFIG_NF_TABLES=y
CONFIG_NF_TABLES_INET=y
CONFIG_NFT_CT=y
CONFIG_NFT_LOG=y
CONFIG_NFT_REJECT=y
CONFIG_NETFILTER_XT_MATCH_CONNTRACK=y
CONFIG_NETFILTER_XT_MATCH_STATE=y
CONFIG_IP_NF_IPTABLES=y
CONFIG_IP_NF_FILTER=y
CONFIG_IP_NF_TARGET_REJECT=y
CONFIG_IP_NF_NAT=y
CONFIG_IP_NF_TARGET_MASQUERADE=y

#
# Device Drivers
#

# Generic
CONFIG_UEVENT_HELPER=y
CONFIG_DEVTMPFS=y
CONFIG_DEVTMPFS_MOUNT=y

# Block devices
CONFIG_BLK_DEV=y
CONFIG_BLK_DEV_LOOP=y
CONFIG_BLK_DEV_RAM=y
CONFIG_BLK_DEV_RAM_COUNT=16
CONFIG_BLK_DEV_RAM_SIZE=65536

# SCSI
CONFIG_SCSI=y
CONFIG_BLK_DEV_SD=y
CONFIG_CHR_DEV_SG=y

# ATA
CONFIG_ATA=y
CONFIG_ATA_PIIX=y
CONFIG_SATA_AHCI=y

# NVME
CONFIG_BLK_DEV_NVME=y

# Virtio (for QEMU/KVM)
CONFIG_VIRTIO=y
CONFIG_VIRTIO_PCI=y
CONFIG_VIRTIO_BLK=y
CONFIG_VIRTIO_NET=y
CONFIG_VIRTIO_CONSOLE=y
CONFIG_VIRTIO_BALLOON=y
CONFIG_VIRTIO_INPUT=y
CONFIG_VIRTIO_MMIO=y

# Network drivers
CONFIG_NETDEVICES=y
CONFIG_NET_CORE=y
CONFIG_ETHERNET=y
CONFIG_NET_VENDOR_INTEL=y
CONFIG_E1000=y
CONFIG_E1000E=y
CONFIG_IGB=y
CONFIG_IXGBE=y
CONFIG_NET_VENDOR_REALTEK=y
CONFIG_8139CP=y
CONFIG_8139TOO=y
CONFIG_R8169=y

# USB
CONFIG_USB_SUPPORT=y
CONFIG_USB=y
CONFIG_USB_XHCI_HCD=y
CONFIG_USB_EHCI_HCD=y
CONFIG_USB_OHCI_HCD=y
CONFIG_USB_STORAGE=y
CONFIG_USB_UAS=y

# Input
CONFIG_INPUT=y
CONFIG_INPUT_KEYBOARD=y
CONFIG_KEYBOARD_ATKBD=y
CONFIG_INPUT_MOUSE=y
CONFIG_MOUSE_PS2=y
CONFIG_SERIO=y
CONFIG_SERIO_I8042=y
CONFIG_SERIO_LIBPS2=y

# Character devices
CONFIG_VT=y
CONFIG_CONSOLE_TRANSLATIONS=y
CONFIG_VT_CONSOLE=y
CONFIG_VT_CONSOLE_SLEEP=y
CONFIG_HW_CONSOLE=y
CONFIG_UNIX98_PTYS=y

# Serial
CONFIG_SERIAL_8250=y
CONFIG_SERIAL_8250_CONSOLE=y

# RTC
CONFIG_RTC_CLASS=y
CONFIG_RTC_DRV_CMOS=y

# Graphics (minimal for console)
CONFIG_VGA_CONSOLE=y
CONFIG_DUMMY_CONSOLE=y
CONFIG_FRAMEBUFFER_CONSOLE=y
CONFIG_DRM=y
CONFIG_DRM_FBDEV_EMULATION=y
CONFIG_DRM_BOCHS=y
CONFIG_DRM_VIRTIO_GPU=y

#
# File Systems
#
CONFIG_EXT4_FS=y
CONFIG_EXT4_USE_FOR_EXT2=y
CONFIG_EXT4_FS_POSIX_ACL=y
CONFIG_EXT4_FS_SECURITY=y

CONFIG_XFS_FS=y

CONFIG_BTRFS_FS=y

CONFIG_VFAT_FS=y
CONFIG_FAT_DEFAULT_CODEPAGE=437
CONFIG_FAT_DEFAULT_IOCHARSET="iso8859-1"

CONFIG_TMPFS=y
CONFIG_TMPFS_POSIX_ACL=y
CONFIG_TMPFS_XATTR=y

CONFIG_SQUASHFS=y
CONFIG_SQUASHFS_XZ=y
CONFIG_SQUASHFS_ZSTD=y

CONFIG_PROC_FS=y
CONFIG_PROC_SYSCTL=y
CONFIG_SYSFS=y
CONFIG_DEVPTS_FS=y

CONFIG_OVERLAY_FS=y

# Network filesystems
CONFIG_NETWORK_FILESYSTEMS=y
CONFIG_NFS_FS=y
CONFIG_NFS_V4=y
CONFIG_CIFS=y

#
# Security Options (Critical for Guardian AI)
#
CONFIG_KEYS=y
CONFIG_SECURITY=y
CONFIG_SECURITYFS=y
CONFIG_SECURITY_NETWORK=y

# Linux Security Modules
CONFIG_SECURITY_PATH=y
CONFIG_LSM_MMAP_MIN_ADDR=65536

# SELinux (optional, can use with Guardian)
CONFIG_SECURITY_SELINUX=y
CONFIG_SECURITY_SELINUX_BOOTPARAM=y
CONFIG_SECURITY_SELINUX_DEVELOP=y
CONFIG_SECURITY_SELINUX_AVC_STATS=y

# AppArmor (alternative to SELinux)
CONFIG_SECURITY_APPARMOR=y
CONFIG_SECURITY_APPARMOR_HASH=y

# Landlock (modern sandboxing)
CONFIG_SECURITY_LANDLOCK=y

# YAMA (ptrace restrictions)
CONFIG_SECURITY_YAMA=y

# LoadPin (module loading restrictions)
CONFIG_SECURITY_LOADPIN=y

# SafeSetID
CONFIG_SECURITY_SAFESETID=y

# Lockdown (kernel lockdown)
CONFIG_SECURITY_LOCKDOWN_LSM=y
CONFIG_SECURITY_LOCKDOWN_LSM_EARLY=y

# BPF LSM (for Guardian AI hooks)
CONFIG_BPF_LSM=y

# Default LSM order
CONFIG_LSM="landlock,lockdown,yama,loadpin,safesetid,bpf,selinux,apparmor"

# Integrity
CONFIG_INTEGRITY=y
CONFIG_INTEGRITY_SIGNATURE=y
CONFIG_IMA=y
CONFIG_IMA_MEASURE_PCR_IDX=10
CONFIG_IMA_LSM_RULES=y
CONFIG_EVM=y

# Seccomp (syscall filtering for Guardian)
CONFIG_SECCOMP=y
CONFIG_SECCOMP_FILTER=y

# Hardening
CONFIG_HARDENED_USERCOPY=y
CONFIG_FORTIFY_SOURCE=y
CONFIG_STACKPROTECTOR=y
CONFIG_STACKPROTECTOR_STRONG=y
CONFIG_STRICT_KERNEL_RWX=y
CONFIG_STRICT_MODULE_RWX=y
CONFIG_RANDOMIZE_BASE=y
CONFIG_RANDOMIZE_MEMORY=y

#
# Cryptographic API
#
CONFIG_CRYPTO=y
CONFIG_CRYPTO_ALGAPI=y
CONFIG_CRYPTO_HASH=y
CONFIG_CRYPTO_SHA256=y
CONFIG_CRYPTO_SHA512=y
CONFIG_CRYPTO_AES=y
CONFIG_CRYPTO_AES_NI_INTEL=y
CONFIG_CRYPTO_GCM=y
CONFIG_CRYPTO_CCM=y
CONFIG_CRYPTO_CHACHA20POLY1305=y
CONFIG_CRYPTO_USER_API=y
CONFIG_CRYPTO_USER_API_HASH=y
CONFIG_CRYPTO_USER_API_SKCIPHER=y
CONFIG_CRYPTO_USER_API_AEAD=y

#
# Library Routines
#
CONFIG_CRC32=y
CONFIG_ZLIB_INFLATE=y
CONFIG_ZLIB_DEFLATE=y
CONFIG_LZO_COMPRESS=y
CONFIG_LZO_DECOMPRESS=y
CONFIG_XZ_DEC=y
CONFIG_ZSTD_COMPRESS=y
CONFIG_ZSTD_DECOMPRESS=y

#
# Kernel Hacking (minimal for production)
#
CONFIG_DEBUG_KERNEL=y
CONFIG_DEBUG_INFO=y
CONFIG_DEBUG_INFO_DWARF_TOOLCHAIN_DEFAULT=y
CONFIG_MAGIC_SYSRQ=y
CONFIG_MAGIC_SYSRQ_DEFAULT_ENABLE=0x1

#
# Compile-time checks
#
CONFIG_CC_OPTIMIZE_FOR_SIZE=y
CONFIG_KALLSYMS=y
CONFIG_PRINTK=y

#
# Modules
#
CONFIG_MODULES=y
CONFIG_MODULE_UNLOAD=y
CONFIG_MODULE_FORCE_UNLOAD=y
CONFIG_MODVERSIONS=y
CONFIG_MODULE_SIG=y
CONFIG_MODULE_SIG_SHA256=y

#
# GNU/Linux Compatibility Features
# (Required for full Debian GNU/Linux userland support)
#

# FUTEX for glibc threading (NPTL)
CONFIG_FUTEX=y
CONFIG_FUTEX_PI=y

# Eventfd for glibc event notification
CONFIG_EVENTFD=y

# Timerfd for glibc timer operations
CONFIG_TIMERFD=y

# Signalfd for signal handling
CONFIG_SIGNALFD=y

# Epoll for efficient I/O multiplexing
CONFIG_EPOLL=y

# AIO for asynchronous I/O (glibc aio)
CONFIG_AIO=y

# io_uring for modern async I/O
CONFIG_IO_URING=y

# FHANDLE for file handle operations
CONFIG_FHANDLE=y

# Fanotify for filesystem monitoring
CONFIG_FANOTIFY=y
CONFIG_FANOTIFY_ACCESS_PERMISSIONS=y

# Inotify for file change notifications
CONFIG_INOTIFY_USER=y

# POSIX message queues
CONFIG_POSIX_MQUEUE_SYSCTL=y

# SystemD compatibility (optional but useful for Debian)
CONFIG_CGROUP_PIDS=y
CONFIG_CGROUP_FREEZER=y
CONFIG_CGROUP_DEVICE=y
CONFIG_CGROUP_CPUACCT=y
CONFIG_CGROUP_PERF=y
CONFIG_CGROUP_NET_CLASSID=y
CONFIG_CGROUP_NET_PRIO=y

# Dbus/kdbus support for inter-process communication
CONFIG_UNIX_DIAG=y

# Netlink for system monitoring
CONFIG_NETLINK_DIAG=y

# Device mapper for LVM/cryptsetup (common on Debian)
CONFIG_BLK_DEV_DM=y
CONFIG_DM_CRYPT=y
CONFIG_DM_SNAPSHOT=y
CONFIG_DM_MIRROR=y
CONFIG_DM_ZERO=y

# Loop device for mounting images
CONFIG_BLK_DEV_LOOP=y
CONFIG_BLK_DEV_LOOP_MIN_COUNT=8

# FUSE for userspace filesystems
CONFIG_FUSE_FS=y
CONFIG_CUSE=y

#
# Debian-specific Kernel Features
#

# Kernel watchdog
CONFIG_WATCHDOG=y
CONFIG_SOFT_WATCHDOG=y

# Kernel same-page merging (memory deduplication)
CONFIG_KSM=y

# Transparent hugepages for better performance
CONFIG_TRANSPARENT_HUGEPAGE=y
CONFIG_TRANSPARENT_HUGEPAGE_MADVISE=y

# Kernel debugging (useful for development)
CONFIG_KPROBES=y
CONFIG_KRETPROBES=y

# Perf events for profiling
CONFIG_PERF_EVENTS=y

# Ftrace for function tracing
CONFIG_FTRACE=y
CONFIG_FUNCTION_TRACER=y

# User namespace support (for rootless containers)
CONFIG_USER_NS=y

# Overlay filesystem (essential for containers)
CONFIG_OVERLAY_FS=y

# End of VA21 Kernel Configuration
# =================================
# This configuration provides a complete stripped-down Linux kernel
# compatible with Debian GNU/Linux and the full GNU toolkit.
#
# Key features enabled:
#   - Full GNU/Linux userland compatibility (glibc, GNU coreutils)
#   - Container support (Docker, Podman, LXC)
#   - Security features (BPF LSM, SELinux, AppArmor, Seccomp)
#   - Guardian AI integration hooks
#   - Minimal hardware driver set for virtual and common physical systems
#
# To customize further, run: make menuconfig
